var app = require('express')();
var http = require('http').Server(app);
var io = require('socket.io')(http);

// Various variables
var population = 0;
var sockets = [];

app.get('/index', function(req, res)
						{
							res.sendFile(__dirname+'/index.html');
						});
app.get('/css', function(req, res)
						{
							res.sendFile(__dirname+'/css.css');
						});
app.get('/server', function(req, res)
							{
								res.sendFile(__dirname+'/server.html');
							});
app.get('/favicon.ico', function(req, res)
							{
								res.sendFile(__dirname+'/favicon.ico');
							});

io.broadcast = function(data)
					{
						for(var i in this.clients)
						{
							this.clients[i].send(data);
						}
					};

// Callback for when someone connects
io.on('connection', 
			function(socket)
			{
				console.log('A user connected');

				sockets.push(socket);

				// Update number of users
				population++;	
		
				socket.emit('newUser', population);

				console.log('Registered user' + population);

				socket.on('disconnect', function()
												{
													// Inform the client
													io.emit('someoneLeft');
													// Update number of users
													population--;
												});
				socket.on('message', function(message)
											{
												console.log("Received: " + message);
												io.broadcast(message);
											});
			});

http.listen(1755, function(){
		     console.log('Listening on *: 1755');
		     });
